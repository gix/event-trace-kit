<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
  </PropertyGroup>

  <PropertyGroup>
    <RepoRoot>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)..\..\'))</RepoRoot>
    <DeveloperBuild>false</DeveloperBuild>
    <DeveloperBuild Condition="'$(OfficialBuild)' != 'true' AND '$(ContinuousIntegrationBuild)' != 'true'">true</DeveloperBuild>
  </PropertyGroup>

  <Import Project="Versions.props" />

  <PropertyGroup>
    <BuildFolder Condition="'$(BuildFolder)' == ''">$(Configuration.ToLowerInvariant())</BuildFolder>

    <BuildRoot Condition="'$(BuildRoot)' == ''">$(RepoRoot)build\</BuildRoot>
    <OutDir>$(BuildRoot)$(BuildFolder)\bin\$(MSBuildProjectName)\</OutDir>
    <IntDir>$(BuildRoot)$(BuildFolder)\obj\$(MSBuildProjectName)\</IntDir>
    <IsDebugBuild Condition="'$(IsDebugBuild)' == '' and $([System.Text.RegularExpressions.Regex]::IsMatch('$(Configuration)', 'Debug'))">true</IsDebugBuild>
    <IsDebugBuild Condition="'$(IsDebugBuild)' == ''">false</IsDebugBuild>
  </PropertyGroup>

  <ItemDefinitionGroup>
    <ClCompile>
      <!-- Optimization -->
      <Optimization Condition="'$(IsDebugBuild)' != 'false'">Disabled</Optimization>
      <InlineFunctionExpansion Condition="'$(IsDebugBuild)' != 'false'">Disabled</InlineFunctionExpansion>
      <WholeProgramOptimization Condition="'$(IsDebugBuild)' != 'false'">false</WholeProgramOptimization>

      <Optimization Condition="'$(IsDebugBuild)' == 'false'">MaxSpeed</Optimization>
      <InlineFunctionExpansion Condition="'$(IsDebugBuild)' == 'false'">Default</InlineFunctionExpansion>
      <AdditionalOptions Condition="'$(IsDebugBuild)' == 'false'">%(AdditionalOptions) /Ob3</AdditionalOptions>
      <OmitFramePointers Condition="'$(IsDebugBuild)' == 'false'">false</OmitFramePointers>
      <WholeProgramOptimization Condition="'$(IsDebugBuild)' == 'false'">true</WholeProgramOptimization>

      <!-- Diagnostics -->
      <WarningLevel>Level4</WarningLevel>
      <DisableSpecificWarnings>4200;4251;4275;4324;4351;4458;4481;4505;4512;%(DisableSpecificWarnings)</DisableSpecificWarnings>
      <TreatSpecificWarningsAsErrors>4013;4099;4150;4172;4477;4715;%(TreatSpecificWarningsAsErrors)</TreatSpecificWarningsAsErrors>
      <AdditionalIncludeDirectories>$(MSBuildThisFileDirectory)..\;%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
      <ProgramDataBaseFileName Condition=" '$(ConfigurationType)' == 'StaticLibrary' ">$(TargetDir)$(TargetName).pdb</ProgramDataBaseFileName>
      <ObjectFileName>$(IntDir)%(RelativeDir)</ObjectFileName>
      <AssemblerListingLocation>$(IntDir)%(RelativeDir)</AssemblerListingLocation>
      <DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
      <!-- CoreCRT options -->
      <PreprocessorDefinitions>__STDC_WANT_LIB_EXT1__;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <PreprocessorDefinitions>_CRT_STDIO_ISO_WIDE_SPECIFIERS;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <PreprocessorDefinitions>_SCL_SECURE_NO_WARNINGS;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <!-- Target Windows 8 -->
      <PreprocessorDefinitions>_WIN32_WINNT=0x0602;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <!-- Windows SDK -->
      <PreprocessorDefinitions>WIN32_LEAN_AND_MEAN;NOMINMAX;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <!-- Enable C++ standard library features removed in C++17 for boost compat. -->
      <PreprocessorDefinitions>_HAS_AUTO_PTR_ETC=1;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <LanguageStandard>stdcpplatest</LanguageStandard>
      <LanguageStandard Condition="'$(CLRSupport)' != 'false'">stdcpp17</LanguageStandard>
      <EnforceTypeConversionRules>true</EnforceTypeConversionRules>
      <ConformanceMode>true</ConformanceMode>
      <AdditionalOptions>-Zc:inline -Zc:strictStrings -Zc:throwingNew -Zc:externConstexpr -Gw %(AdditionalOptions)</AdditionalOptions>
      <AdditionalOptions Condition="'$(CLRSupport)' != 'false'">%(AdditionalOptions) -Zc:twoPhase-</AdditionalOptions>
      <DiagnosticsFormat>Caret</DiagnosticsFormat>
    </ClCompile>

    <Lib>
      <TargetMachine Condition="'$(Platform)'=='Win32'">MachineX86</TargetMachine>
      <TargetMachine Condition="'$(Platform)'=='x64'">MachineX64</TargetMachine>
    </Lib>
    <Lib Condition="'$(IsDebugBuild)'=='false'">
      <LinkTimeCodeGeneration>true</LinkTimeCodeGeneration>
    </Lib>

    <Link Condition="'$(IsDebugBuild)'!='false'">
      <GenerateDebugInformation>DebugFastLink</GenerateDebugInformation>
    </Link>
    <Link Condition="'$(IsDebugBuild)'=='false'">
      <GenerateDebugInformation>DebugFull</GenerateDebugInformation>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <LinkTimeCodeGeneration>UseFastLinkTimeCodeGeneration</LinkTimeCodeGeneration>
      <ImageHasSafeExceptionHandlers Condition="'$(Platform)'=='Win32'">true</ImageHasSafeExceptionHandlers>
      <SetChecksum>true</SetChecksum>
    </Link>

    <FxCompile>
      <ObjectFileOutput>$(IntDir)%(RelativeDir)%(Filename).cso</ObjectFileOutput>
    </FxCompile>

    <ResourceCompile>
      <ResourceOutputFileName>$(IntDir)%(RelativeDir)%(Filename).res</ResourceOutputFileName>
    </ResourceCompile>
  </ItemDefinitionGroup>
</Project>
